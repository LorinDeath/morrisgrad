---
import Layout from '../layouts/Layout.astro';
import Notes from '../components/Notes.astro';
import lorinImg from '../assets/lorin.png';
import lorin1Img from '../assets/lorin1.png';
---
<Layout title="МиниИгры | Моррис Град">
    <main class="container">
        <div class="title-wrapper">
            <div class="line line-left"></div>
            <h1>Мини-игры</h1>
            <div class="line line-right"></div>
        </div>

        <div class="shimmer-line"></div>

        <div class="games-grid">
            <div class="game-card" 
                 data-title="Заглушка v0.2" 
                 data-desc="Это всего лишь временная заглушка, чтобы удержать внимание пользователя на странице. Когда нибудь Алзор подлючит энергоблок к данной мини игре и игроки будут вырабатывать энергию для развития своего мини городка. Но это не точно." 
                 data-game-url="/games/zaglushka" 
                 data-changelog-url="/changelog-zaglushka">
                <img src={lorinImg.src} alt="Заглушка v0.2" class="game-icon" />
                <span class="game-title">Заглушка v0.2</span>
            </div>
            
            <div class="game-card" 
                 data-title="Это мы с тобой!" 
                 data-desc="Я никогда не думала, что скажу это... Но мы лишь точки в этом мире, Алзор может в любой момент убить нас, вернуть к жизни, сделать всё что угодно. Но я верю что у него есть сердце, но он просто исчез. Ты же не исчезнешь, Элфдид?" 
                 data-game-url="/games/echo" 
                 data-changelog-url="/changelog-echo">
                <img src={lorin1Img.src} alt="Это мы с тобой!" class="game-icon" />
                <span class="game-title">Это мы с тобой!</span>
            </div>

            <div class="game-card" 
                 data-title="Рогалик" 
                 data-desc="Тест." 
                 data-game-url="/games/roguelike" 
                 data-changelog-url="#">
                <img src={lorinImg.src} alt="Рогалик" class="game-icon" />
                <span class="game-title">Рогалик</span>
            </div>
        </div>

        <div class="shimmer-line"></div>
        
        <div class="glitch-container">
            <h2 class="glitch-calm" data-text="В РАЗРАБОТКЕ!">В РАЗРАБОТКЕ!</h2>
        </div>

        <Notes />
    </main>

    <!-- Модальное окно для игр -->
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="modal-img" src="" alt="Game Icon" class="modal-icon" />
            <h2 id="modal-title">Название игры</h2>
            <p id="modal-desc">Описание игры...</p>
            <div class="modal-actions">
                <a id="modal-start-btn" href="#" class="start-btn">Начать играть</a>
                <a id="modal-changelog-link" href="#" class="changelog-link">Список изменений ></a>
            </div>
        </div>
    </div>
  
</Layout>

<style>
    .games-grid {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
        margin: 3rem 0;
    }

    .game-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: #e0e0e0;
        background-color: rgba(20, 20, 25, 0.8);
        border: 2px solid #444;
        border-radius: 15px;
        padding: 1.5rem;
        width: 250px;
        text-align: center;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .game-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 25px var(--accent-gold, #ffd700);
        border-color: var(--accent-gold, #ffd700);
    }

    .game-icon {
        width: 150px;
        height: 150px;
        border-radius: 10px;
        object-fit: cover;
        margin-bottom: 1rem;
        border: 3px solid #555;
        transition: border-color 0.3s ease;
    }

    .game-card:hover .game-icon {
        border-color: var(--accent-gold, #ffd700);
    }

    .game-title {
        font-size: 1.2rem;
        font-weight: bold;
    }

    .title-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1.5rem;
        margin-top: 1rem;
        margin-bottom: 1rem;
    }

    .title-wrapper h1 {
        margin: 0;
        white-space: nowrap;
    }

    .line {
        flex: 1;
        height: 4px;
        background: var(--accent-gold, #ffd700);
        animation: pulse-gold 2s infinite ease-in-out;
    }

    .line-left {
        background: linear-gradient(90deg, transparent, var(--accent-gold, #ffd700));
        clip-path: polygon(0 45%, 100% 0, 100% 100%, 0 55%);
    }

    .line-right {
        background: linear-gradient(90deg, var(--accent-gold, #ffd700), transparent);
        clip-path: polygon(0 0, 100% 45%, 100% 55%, 0 100%);
    }

    @keyframes pulse-gold {
        0%, 100% { opacity: 0.6; filter: drop-shadow(0 0 3px var(--accent-gold, #ffd700)); }
        50% { opacity: 1; filter: drop-shadow(0 0 8px var(--accent-gold, #ffd700)); }
    }

    .center-title {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--accent-gold, #ffd700);
    }

    .glitch-container {
        text-align: center;
        margin: 3rem 0;
    }

    /* Спокойный глитч */
    .glitch-calm {
        font-size: 3rem;
        font-weight: 900;
        text-transform: uppercase;
        position: relative;
        color: #fff;
        letter-spacing: 0.1em;
        /* Статичное смещение для красоты (хроматическая аберрация) */
        text-shadow: 2px 0 rgba(255, 0, 0, 0.5), -2px 0 rgba(0, 255, 255, 0.5);
        animation: calm-pulse 3s infinite;
    }

    @keyframes calm-pulse {
        0%, 100% { opacity: 1; text-shadow: 2px 0 rgba(255, 0, 0, 0.5), -2px 0 rgba(0, 255, 255, 0.5); }
        50% { opacity: 0.9; text-shadow: 3px 0 rgba(255, 0, 0, 0.6), -3px 0 rgba(0, 255, 255, 0.6); }
        52% { opacity: 0.8; text-shadow: -2px 0 rgba(255, 0, 0, 0.6), 2px 0 rgba(0, 255, 255, 0.6); transform: skewX(2deg); }
        53% { opacity: 1; transform: skewX(0); }
    }

    @media (max-width: 600px) {
        /* Можно добавить стили для мобильных устройств, если нужно */
    }

    /* Стили модального окна */
    .modal {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85);
        display: flex; justify-content: center; align-items: center;
        z-index: 2000;
        opacity: 0; pointer-events: none; transition: opacity 0.3s;
        backdrop-filter: blur(5px);
    }
    .modal.active { opacity: 1; pointer-events: auto; }
    
    .modal-content {
        background: #151515;
        border: 2px solid var(--accent-gold, #ffd700);
        padding: 2rem;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        position: relative;
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
        display: flex; flex-direction: column; align-items: center;
    }
    
    .modal-icon {
        width: 120px; height: 120px;
        border-radius: 10px;
        object-fit: cover;
        border: 3px solid #555;
        margin-bottom: 1rem;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    
    .close-modal {
        position: absolute; top: 10px; right: 15px;
        font-size: 2rem; color: #aaa; cursor: pointer;
        line-height: 1;
    }
    .close-modal:hover { color: #fff; }
    
    .modal-actions {
        display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem; width: 100%; align-items: center;
    }
    
    .start-btn {
        background: var(--accent-gold, #ffd700);
        color: #000;
        padding: 10px 30px;
        border-radius: 30px;
        font-weight: bold;
        text-decoration: none;
        font-size: 1.2rem;
        transition: transform 0.2s;
    }
    .start-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--accent-gold, #ffd700); }
    
    .changelog-link {
        color: var(--accent-gold, #ffd700);
        text-decoration: none;
        border-bottom: 1px dashed var(--accent-gold, #ffd700);
        font-size: 0.9rem;
    }
    .changelog-link:hover { color: #fff; border-color: #fff; }
    
    #modal-desc {
        color: #ccc;
        line-height: 1.5;
        margin-bottom: 1rem;
    }
    #modal-title {
        color: #fff;
        margin-bottom: 0.5rem;
    }
</style>

<script>
    // Используем astro:page-load, чтобы скрипт работал при переходах между страницами
    document.addEventListener('astro:page-load', () => {
        const modal = document.getElementById('game-modal');
        const modalImg = document.getElementById('modal-img') as HTMLImageElement;
        const modalTitle = document.getElementById('modal-title');
        const modalDesc = document.getElementById('modal-desc');
        const startBtn = document.getElementById('modal-start-btn');
        const changelogLink = document.getElementById('modal-changelog-link');
        const closeBtn = document.querySelector('.close-modal');

        if (!modal) return;

        document.querySelectorAll('.game-card').forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                
                const img = card.querySelector('.game-icon');
                const src = img ? img.getAttribute('src') : '';
                const title = card.getAttribute('data-title');
                const desc = card.getAttribute('data-desc');
                const gameUrl = card.getAttribute('data-game-url');
                const changelogUrl = card.getAttribute('data-changelog-url');

                if (modalImg && src) modalImg.src = src;
                if (modalTitle && title) modalTitle.textContent = title;
                if (modalDesc && desc) modalDesc.textContent = desc;
                if (startBtn && gameUrl) startBtn.setAttribute('href', gameUrl);
                if (changelogLink && changelogUrl) changelogLink.setAttribute('href', changelogUrl);

                modal.classList.add('active');
            });
        });

        const closeModal = () => {
            modal.classList.remove('active');
        };

        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });
    });
</script>
